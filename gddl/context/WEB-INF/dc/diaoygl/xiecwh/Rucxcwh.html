<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GB2312">
<title>电厂入厂车辆（火车）卸车维护</title>
<link jwcid="@Any" rel="stylesheet" type="text/css"
	href="ognl:assets.extallcss" />
<link jwcid="@Any" rel="stylesheet" type="text/css"
	href="ognl:assets.datetimecss" />
<link jwcid="@Any" rel="stylesheet" type="text/css" href="ognl:assets.datetimecss"></link>
<script jwcid="@Any" type="text/javascript" src="ognl:assets.extbasejs"></script>
<script jwcid="@Any" type="text/javascript" src="ognl:assets.extalljs"></script>
<script jwcid="@Any" type="text/javascript" src="ognl:assets.pagingmpjs"></script>
<script jwcid="@Any" type="text/javascript" src="ognl:assets.extlangjs"></script>
<script jwcid="@Any" type="text/javascript"	src="ognl:assets.XGridPluginjs"></script>
<script jwcid="@Any" type="text/javascript" src="ognl:assets.datetimefield"></script>
<script jwcid="@Any" type="text/javascript" src="ognl:assets.datetimepicker"></script>

<script type="text/javascript">
var ks;
var jz;
var gridDiv_history = "";
Ext.onReady(function(){
var url = "http://"+document.location.host+document.location.pathname;
var end = url.indexOf("/app");
url = url.substring(0,end);
Ext.BLANK_IMAGE_URL = url+'/ext/resources/images/s.gif';
<span jwcid="@Insert" raw="true" value="ognl:msg"></span>
<span jwcid="@Insert" raw="true" value="ognl:GridScript"></span>

gridDiv_grid.addListener('afteredit',function(e){
	var val=gridDiv_ds.getAt(e.row).get(e.field);
		var rcd=gridDiv_ds.getModifiedRecords();
		if(e.field=='DIAODY'){
			for(i=0;i<rcd.length;i++){
				if(rcd[i].get('ZHUANGT')=='√'){
					rcd[i].set('DIAODY',val);
				}
			}		
		}
		if(e.field=='KAISSJ'){
			var rcd=gridDiv_ds.getRange(e.row,gridDiv_ds.getCount());
			var flag=rcd.length;
			for(i=0;i<rcd.length;i++){
				if(rcd[i].get('ZHUANGT')=='√'){
					if(rcd[i].get('KAISSJ')==val){
						flag=i;
					}
					if(i>=flag){
						rcd[i].set('KAISSJ',val);
					}					

				}
			}		
		}
		if(e.field=='JIEZSJ'){
			var rcd=gridDiv_ds.getRange(e.row,gridDiv_ds.getCount());
			var flag=rcd.length;
			for(i=0;i<rcd.length;i++){
				if(rcd[i].get('ZHUANGT')=='√'){
					if(rcd[i].get('JIEZSJ')==val){
						flag=i;
					}
					if(i>=flag){
						rcd[i].set('JIEZSJ',val);
					}					

				}
			}		
		}

		if(e.field=='MEIC'){
			var rcd=gridDiv_ds.getRange(e.row,gridDiv_ds.getCount());
			var flag=rcd.length;
			for(i=0;i<rcd.length;i++){
				if(rcd[i].get('ZHUANGT')=='√'){
					if(rcd[i].get('MEIC')==val){
						flag=i;
					}
					if(i>=flag&&rcd[i].get('XIECFS')=='外卸'){
						rcd[i].set('MEIC',val);
					}					
				}
			}	
			
		}
		
		if(e.field=='XIECFS'){
			var rcd=gridDiv_ds.getRange(e.row,gridDiv_ds.getCount());
			var flag=rcd.length;
			for(i=0;i<rcd.length;i++){
				if(rcd[i].get('ZHUANGT')=='√'){
					if(rcd[i].get('XIECFS')==val){
						flag=i;
					}
					if(i>=flag){
						rcd[i].set('XIECFS',val);
					}					
				}
			}	
			
		}


	});
	
gridDiv_grid.addListener('cellclick',function(t,r,c,e){

			if(c==2){
				
				if(gridDiv_ds.getAt(r).get('ZHUANGT')=='×'){
				
					gridDiv_ds.getAt(r).set('ZHUANGT','√');
				}else{
					
					gridDiv_ds.getAt(r).set('ZHUANGT','×');
				}
			
				var rcd=gridDiv_ds.getModifiedRecords();
				var D='';
				var K='';
				var J='';
				var M='';
				var X='';
				for(i=0;i<rcd.length;i++){
					if(rcd[i].get('DIAODY')!=''){
						D=rcd[i].get('DIAODY');
					}
					if(rcd[i].get('KAISSJ')!=''){
						K=rcd[i].get('KAISSJ');
					}
					if(rcd[i].get('JIEZSJ')!=''){
						J=rcd[i].get('JIEZSJ');
					}
					if(rcd[i].get('MEIC')!=''){
						M=rcd[i].get('MEIC');
					}
					if(rcd[i].get('XIECFS')!=''){
						X=rcd[i].get('XIECFS');
					}
	
					
					if(rcd[i].get('ZHUANGT')==true||rcd[i].get('ZHUANGT')=='√'){ 
						rcd[i].set('ZHUANGT','√');
					}else{
					    rcd[i].set('ZHUANGT','×');     
					} 
				} 
				rcd=gridDiv_ds.getRange(0,gridDiv_ds.getCount());
				
				for(i=0;i<rcd.length;i++){    
					if(rcd[i].get('ZHUANGT')=='×'||rcd[i].get('ZHUANGT')==''){
					    rcd[i].set('DIAODY','');
					    rcd[i].set('KAISSJ','');
					    rcd[i].set('JIEZSJ','');
					    rcd[i].set('MEIC','');
						rcd[i].set('XIECFS','');
					}else{
					
						rcd[i].set('DIAODY',D);
					    rcd[i].set('KAISSJ',K);
					    rcd[i].set('JIEZSJ',J);
					    rcd[i].set('MEIC',M);
					    rcd[i].set('XIECFS',X);
					}
				} 
			
			}
						
});	

});
</script>
</head>
<body id="body">
<script jwcid="@Any" type="text/javascript" src="ognl:assets.Mainjs"></script>
<form listener="ognl:listeners.submit" jwcid="@Form"
	delegate="ognl:beans.delegate">
    <span
		jwcid="SaveButton@ZRcontrib:ImgButton" buttontype="" label="保存"
		style="display:none" id="SaveButton"
		listener="ognl:listeners.SaveButton"></span> 
    <span
		jwcid="RefreshButton@ZRcontrib:ImgButton" buttontype="" label="刷新"
		style="display:none" id="RefreshButton"
		listener="ognl:listeners.RefreshButton"></span> 
    <span id="CHANGE"
		jwcid="CHANGE" style="display:none"></span>
    <!--
     <span id="KSRIQDropDown" jwcid="KSRIQDropDown" style="display:none"></span>
     <span id="JZRIQDropDown" jwcid="JZRIQDropDown" style="display:none"></span>
     -->
     <span id="RCJZSJDropDown" jwcid="RCJZSJDropDown" style="display:none"></span>
     <span id="RCKSSJDropDown" jwcid="RCKSSJDropDown" style="display:none"></span>
     <span id="Kaissj" jwcid="XCKaissj" style="display:none"></span>
     <span id="Jiezsj" jwcid="XCJiezsj" style="display:none"></span>
     <span id="RCKSRiq" jwcid="RCKSRiq" style="display:none"></span>
     <span id="RCJZRiq" jwcid="RCJZRiq" style="display:none"></span>
     <div id="gridDiv" style="width:100%;height:100%;overflow:none"></div>
     <span jwcid="@Insert" raw="true" value="ognl:GridHtml"></span>
</form>
	
	
</body>
<script type="text/javascript">
		document.getElementById('gridDiv').style.height=body.clientHeight-70;
</script>
</html>

